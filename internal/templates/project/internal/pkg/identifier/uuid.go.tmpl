package identifier

import (
	"fmt"
	"time"

	"github.com/gofrs/uuid/v5"
)

func NewID() string {
	return uuid.Must(uuid.NewV7()).String()
}

func ValidateID(id string) error {
	_, err := uuid.FromString(id)
	if err != nil {
		return fmt.Errorf("invalid UUID: %w", err)
	}
	return nil
}

func ExtractTimestamp(id string) (time.Time, error) {
	u, err := uuid.FromString(id)
	if err != nil {
		return time.Time{}, fmt.Errorf("invalid UUID: %w", err)
	}

	ts, err := uuid.TimestampFromV7(u)
	if err != nil {
		return time.Time{}, fmt.Errorf("not a UUIDv7: %w", err)
	}

	t, err := ts.Time()
	if err != nil {
		return time.Time{}, fmt.Errorf("failed to convert timestamp: %w", err)
	}

	return t, nil
}
