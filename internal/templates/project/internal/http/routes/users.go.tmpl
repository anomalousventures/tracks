package routes

import (
	"net/url"
)

// usersPath and usernameParam are unexported to prevent tight coupling across packages.
const (
	usersPath     = "users"
	usernameParam = "username"
)

// HYPERMEDIA-First Pattern (Default for all generated resources):
// Routes serve HTML via templ and include form routes (/new, /edit) for RESTful HTML.
//
// API Alternative: Use --api flag to generate JSON routes with /api prefix and no forms.
//
// Type-Safe URL Generation:
// Use typed helpers (UserShowURL, UserEditURL, etc.) instead of manual string concatenation.
// Provides compile-time safety and automatic URL encoding to prevent injection attacks.
const (
	UserIndex  = "/" + usersPath
	UserShow   = "/" + usersPath + "/:" + usernameParam
	UserNew    = "/" + usersPath + "/new"
	UserCreate = "/" + usersPath
	UserEdit   = "/" + usersPath + "/:" + usernameParam + "/edit"
	UserUpdate = "/" + usersPath + "/:" + usernameParam
	UserDelete = "/" + usersPath + "/:" + usernameParam
)

// RouteURL is a low-level helper. Use typed functions (UserShowURL, etc.) for better type safety.
func RouteURL(route string, params ...string) string {
	if len(params) == 0 {
		return route
	}

	result := route
	for i := 0; i < len(params); i += 2 {
		if i+1 >= len(params) {
			break
		}
		key := params[i]
		value := params[i+1]
		placeholder := ":" + key
		result = replaceFirst(result, placeholder, url.PathEscape(value))
	}
	return result
}

// replaceFirst avoids importing strings package to keep route files lightweight.
func replaceFirst(s, old, new string) string {
	idx := 0
	for i := 0; i <= len(s)-len(old); i++ {
		if s[i:i+len(old)] == old {
			idx = i
			return s[:idx] + new + s[idx+len(old):]
		}
	}
	return s
}

func UserIndexURL() string {
	return UserIndex
}

func UserShowURL(username string) string {
	return RouteURL(UserShow, usernameParam, username)
}

func UserNewURL() string {
	return UserNew
}

func UserCreateURL() string {
	return UserCreate
}

func UserEditURL(username string) string {
	return RouteURL(UserEdit, usernameParam, username)
}

func UserUpdateURL(username string) string {
	return RouteURL(UserUpdate, usernameParam, username)
}

func UserDeleteURL(username string) string {
	return RouteURL(UserDelete, usernameParam, username)
}
