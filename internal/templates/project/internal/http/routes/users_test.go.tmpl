package routes

import (
	"testing"

	"github.com/stretchr/testify/assert"
)

func TestUserRoutes(t *testing.T) {
	t.Run("route constants have correct values", func(t *testing.T) {
		assert.Equal(t, "/users", UserIndex)
		assert.Equal(t, "/users/:username", UserShow)
		assert.Equal(t, "/users/new", UserNew)
		assert.Equal(t, "/users", UserCreate)
		assert.Equal(t, "/users/:username/edit", UserEdit)
		assert.Equal(t, "/users/:username", UserUpdate)
		assert.Equal(t, "/users/:username", UserDelete)
	})

	t.Run("routes follow HYPERMEDIA pattern", func(t *testing.T) {
		// HYPERMEDIA routes use readable slugs like :username (not :id)
		assert.Contains(t, UserShow, ":username")
		assert.Contains(t, UserEdit, ":username")
		assert.Contains(t, UserUpdate, ":username")
		assert.Contains(t, UserDelete, ":username")
	})

	t.Run("routes do not contain /api/ prefix", func(t *testing.T) {
		// HYPERMEDIA routes serve HTML, not JSON APIs
		assert.NotContains(t, UserIndex, "/api/")
		assert.NotContains(t, UserShow, "/api/")
		assert.NotContains(t, UserNew, "/api/")
		assert.NotContains(t, UserCreate, "/api/")
		assert.NotContains(t, UserEdit, "/api/")
		assert.NotContains(t, UserUpdate, "/api/")
		assert.NotContains(t, UserDelete, "/api/")
	})

	t.Run("routes include form routes for HYPERMEDIA", func(t *testing.T) {
		// HYPERMEDIA patterns include /new and /edit for HTML forms
		assert.Contains(t, UserNew, "/new")
		assert.Contains(t, UserEdit, "/edit")
	})

	t.Run("parameter constants have correct values", func(t *testing.T) {
		assert.Equal(t, "users", usersPath)
		assert.Equal(t, "username", UsernameParam)
	})
}

func TestRouteURL(t *testing.T) {
	tests := []struct {
		name     string
		route    string
		params   []string
		expected string
	}{
		{
			name:     "no parameters",
			route:    "/users",
			params:   nil,
			expected: "/users",
		},
		{
			name:     "single parameter",
			route:    "/users/:username",
			params:   []string{"username", "john"},
			expected: "/users/john",
		},
		{
			name:     "multiple parameters",
			route:    "/users/:username/posts/:posts",
			params:   []string{"username", "john", "posts", "hello-world"},
			expected: "/users/john/posts/hello-world",
		},
		{
			name:     "URL encodes spaces",
			route:    "/users/:username",
			params:   []string{"username", "john doe"},
			expected: "/users/john%20doe",
		},
		{
			name:     "URL encodes special characters",
			route:    "/users/:username",
			params:   []string{"username", "user@example.com"},
			expected: "/users/user%40example.com",
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			result := RouteURL(tt.route, tt.params...)
			assert.Equal(t, tt.expected, result)
		})
	}
}

func TestUserHelpers(t *testing.T) {
	t.Run("UserIndexURL returns correct path", func(t *testing.T) {
		assert.Equal(t, "/users", UserIndexURL())
	})

	t.Run("UserShowURL with normal username", func(t *testing.T) {
		assert.Equal(t, "/users/john", UserShowURL("john"))
	})

	t.Run("UserShowURL with special characters", func(t *testing.T) {
		assert.Equal(t, "/users/user%40example.com", UserShowURL("user@example.com"))
	})

	t.Run("UserNewURL returns correct path", func(t *testing.T) {
		assert.Equal(t, "/users/new", UserNewURL())
	})

	t.Run("UserCreateURL returns correct path", func(t *testing.T) {
		assert.Equal(t, "/users", UserCreateURL())
	})

	t.Run("UserEditURL with normal username", func(t *testing.T) {
		assert.Equal(t, "/users/john/edit", UserEditURL("john"))
	})

	t.Run("UserEditURL with special characters", func(t *testing.T) {
		assert.Equal(t, "/users/user%40example.com/edit", UserEditURL("user@example.com"))
	})

	t.Run("UserUpdateURL with normal username", func(t *testing.T) {
		assert.Equal(t, "/users/john", UserUpdateURL("john"))
	})

	t.Run("UserUpdateURL with special characters", func(t *testing.T) {
		assert.Equal(t, "/users/user%40example.com", UserUpdateURL("user@example.com"))
	})

	t.Run("UserDeleteURL with normal username", func(t *testing.T) {
		assert.Equal(t, "/users/john", UserDeleteURL("john"))
	})

	t.Run("UserDeleteURL with special characters", func(t *testing.T) {
		assert.Equal(t, "/users/user%40example.com", UserDeleteURL("user@example.com"))
	})
}
