/**
 * {{.ProjectName}} - Main JavaScript Application
 *
 * This file provides the JavaScript entry point for the application.
 * It will be bundled by esbuild and minified for production.
 */

// Import HTMX and extensions
import htmx from 'htmx.org';
import 'htmx-ext-head-support';
import 'idiomorph';
import 'htmx-ext-response-targets';

// Make HTMX globally available
window.htmx = htmx;

(function() {
  'use strict';

  /**
   * Application state and configuration
   */
  const App = {
    name: '{{.ProjectName}}',
    version: '1.0.0',
    debug: false,

    /**
     * Initialize the application
     */
    init() {
      this.debug = this.isDevelopment();
      this.log('Initializing application...');

      this.setupEventListeners();
      this.onReady(() => {
        this.log('Application ready');
      });
    },

    /**
     * Check if running in development mode
     */
    isDevelopment() {
      return window.location.hostname === 'localhost' ||
             window.location.hostname === '127.0.0.1' ||
             window.location.hostname.endsWith('.local');
    },

    /**
     * Debug logging utility
     */
    log(...args) {
      if (this.debug) {
        console.log(`[${this.name}]`, ...args);
      }
    },

    /**
     * Error logging utility
     */
    error(...args) {
      console.error(`[${this.name}]`, ...args);
    },

    /**
     * Execute callback when DOM is ready
     */
    onReady(callback) {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', callback);
      } else {
        callback();
      }
    },

    /**
     * Setup global event listeners
     */
    setupEventListeners() {
      this.log('Setting up event listeners...');

      // Form validation helpers
      document.querySelectorAll('form[data-validate]').forEach(form => {
        form.addEventListener('submit', (e) => {
          if (!form.checkValidity()) {
            e.preventDefault();
            e.stopPropagation();
            this.log('Form validation failed');
          }
          form.classList.add('was-validated');
        });
      });

      // External link handling
      document.querySelectorAll('a[href^="http"]').forEach(link => {
        if (!link.hostname.includes(window.location.hostname)) {
          link.setAttribute('target', '_blank');
          link.setAttribute('rel', 'noopener noreferrer');
        }
      });

      // HTMX event listeners
      document.body.addEventListener('htmx:configRequest', (e) => {
        this.log('HTMX request:', e.detail.path);
      });

      document.body.addEventListener('htmx:afterSwap', (e) => {
        this.log('HTMX swap complete:', e.detail.target);
      });

      document.body.addEventListener('htmx:responseError', (e) => {
        this.error('HTMX error:', e.detail);
      });
    }
  };

  // Auto-initialize on load
  App.init();

  // Export to global scope for debugging
  window.App = App;
})();
