/**
 * {{.ProjectName}} - Main JavaScript Application
 *
 * This file provides the JavaScript entry point for the application.
 * It will be bundled by esbuild and minified for production.
 */

import './lib/htmx.js';
import 'htmx-ext-head-support';
import 'idiomorph';
import 'htmx-ext-response-targets';

(function() {
  'use strict';

  const App = {
    name: '{{.ProjectName}}',
    version: '1.0.0',
    debug: false,

    init() {
      this.debug = this.isDevelopment();
      this.log('Initializing application...');

      this.setupEventListeners();
      this.onReady(() => {
        this.log('Application ready');
      });
    },

    isDevelopment() {
      return window.location.hostname === 'localhost' ||
             window.location.hostname === '127.0.0.1' ||
             window.location.hostname.endsWith('.local');
    },

    log(...args) {
      if (this.debug) {
        console.log(`[${this.name}]`, ...args);
      }
    },

    error(...args) {
      console.error(`[${this.name}]`, ...args);
    },

    onReady(callback) {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', callback);
      } else {
        callback();
      }
    },

    setupEventListeners() {
      this.log('Setting up event listeners...');

      // Form validation helpers
      document.querySelectorAll('form[data-validate]').forEach(form => {
        form.addEventListener('submit', (e) => {
          if (!form.checkValidity()) {
            e.preventDefault();
            e.stopPropagation();
            this.log('Form validation failed');
          }
          form.classList.add('was-validated');
        });
      });

      // External link handling
      document.querySelectorAll('a[href^="http"]').forEach(link => {
        if (!link.hostname.includes(window.location.hostname)) {
          link.setAttribute('target', '_blank');
          link.setAttribute('rel', 'noopener noreferrer');
        }
      });

      // HTMX event listeners
      document.body.addEventListener('htmx:configRequest', (e) => {
        this.log('HTMX request:', e.detail.path);
      });

      document.body.addEventListener('htmx:afterSwap', (e) => {
        this.log('HTMX swap complete:', e.detail.target);
      });

      document.body.addEventListener('htmx:responseError', (e) => {
        this.error('HTMX error:', e.detail);
      });
    }
  };

  // Auto-initialize on load
  App.init();

  // Export to global scope for debugging
  window.App = App;
})();
