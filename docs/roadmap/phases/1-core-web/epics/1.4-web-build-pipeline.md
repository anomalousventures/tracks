# Epic 1.4: Web Build Pipeline

[← Back to Phase 1](../1-core-web.md) | [← Epic 1.3](./1.3-hashfs-assets.md)

## Overview

Establish the web build pipeline for TailwindCSS compilation, JavaScript bundling with esbuild, Alpine.js integration, and Air live reload configuration. This epic creates the complete frontend asset processing workflow with development and production modes, automatic rebuilds on file changes, and optimization for production deployments.

## Goals

- TailwindCSS configured to scan .templ files
- JIT mode for minimal CSS bundle sizes
- Dark mode support with class-based strategy
- esbuild for JavaScript bundling and minification
- Alpine.js integrated for minimal interactivity
- Air configured for live reload during development
- Makefile targets for asset building
- Development vs production build modes
- Source maps for debugging

## Scope

### In Scope

- TailwindCSS configuration (tailwind.config.js)
- Tailwind CLI via npx (no npm install required)
- JIT mode scanning .templ files
- Dark mode with class strategy
- Custom color palette and theme
- esbuild for JavaScript bundling
- Alpine.js integration (3.x)
- Source maps for development
- Minification for production
- Air configuration (.air.toml)
- Watch .templ, .css, .js files
- Rebuild assets on changes
- Makefile targets (assets, css, js, dev)
- PostCSS configuration (if needed)

### Out of Scope

- Templ-UI components (Epic 1.5)
- Complex JavaScript frameworks (React, Vue)
- TypeScript compilation (future)
- Sass/SCSS preprocessing
- CSS modules
- Advanced PostCSS plugins
- Service workers
- PWA manifest generation

## Task Breakdown

The following tasks will become GitHub issues, ordered by dependency:

### Phase 1: TailwindCSS Foundation (Tasks 1-12)

1. Create tailwind.config.js template
2. Create input CSS file (web/css/app.css)
3. Add Makefile target for CSS compilation
4. Configure Tailwind to scan templ files
5. Add dark mode configuration
6. Create custom color palette
7. Add custom spacing scale (if needed)
8. Configure typography plugin (optional)
9. Add forms plugin (optional)
10. Create safelist for dynamic classes
11. Add custom utilities (if needed)
12. Test Tailwind compilation

### Phase 2: JavaScript Pipeline (Tasks 13-24)

1. Create JavaScript entry point (web/js/app.js)
2. Add Makefile target for JavaScript bundling
3. Configure esbuild for bundling
4. Add Alpine.js integration
5. Create Alpine.js components
6. Add Alpine.js store for global state
7. Create Alpine.js directives cheat sheet
8. Add HTMX integration
9. Create JavaScript utilities
10. Add source map support
11. Configure esbuild minification
12. Test JavaScript bundling

### Phase 3: Air Live Reload (Tasks 25-35)

1. Create .air.toml configuration
2. Configure Air build command
3. Add Air to tool directive in go.mod
4. Configure Air file watching
5. Set Air delay for rebuilds
6. Configure Air binary output
7. Add Air run flags
8. Create Makefile target for dev mode
9. Test Air live reload
10. Configure Air for cross-platform
11. Document Air troubleshooting

### Phase 4: Build Targets (Tasks 36-45)

1. Create Makefile target: make assets
2. Create Makefile target: make css
3. Create Makefile target: make js
4. Create Makefile target: make dev
5. Create Makefile target: make build
6. Add Makefile target: make clean
7. Create Makefile target: make watch-css
8. Create Makefile target: make watch-js
9. Add environment-based build modes
10. Document Makefile targets

### Phase 5: Optimization & Testing (Tasks 46-50)

1. Add PurgeCSS configuration (via Tailwind)
2. Optimize bundle sizes
3. Add bundle analysis
4. Create build performance benchmarks
5. Test production builds

## Dependencies

### Prerequisites

- Phase 0 completed (project generation working)
- Epic 1.1 completed (Chi router)
- Epic 1.2 completed (Templ templates)
- Epic 1.3 completed (HashFS assets)
- Node.js 24+ (for npx Tailwind and esbuild)

### External Dependencies

- TailwindCSS (via npx)
- esbuild (via npx)
- Alpine.js (loaded via CDN or bundled)
- HTMX (loaded via CDN initially)
- Air (via `go tool air`)

### Blocks

- Epic 1.5 (Templ-UI Integration) - needs Tailwind and Alpine.js working

## Acceptance Criteria

### TailwindCSS

- [ ] tailwind.config.js configured to scan .templ files
- [ ] JIT mode enabled for minimal CSS
- [ ] Dark mode class strategy working
- [ ] Custom color palette defined
- [ ] CSS compiles successfully with `make css`
- [ ] Production builds purge unused CSS
- [ ] Source maps generated in development

### JavaScript & Alpine.js

- [ ] esbuild bundles JavaScript successfully
- [ ] Alpine.js integrated and functional
- [ ] Theme toggler works (dark mode)
- [ ] Mobile menu toggle works
- [ ] Alpine.js store configured for global state
- [ ] Source maps generated in development
- [ ] Production builds minified

### Air Live Reload

- [ ] Air configured to watch .templ, .css, .js files
- [ ] Changes trigger automatic rebuilds
- [ ] Build order correct (generate → assets → build)
- [ ] Excludes generated files from watch
- [ ] `make dev` runs Air successfully
- [ ] Cross-platform support (Linux, macOS, Windows)

### Build Targets

- [ ] `make assets` builds CSS and JS
- [ ] `make css` compiles Tailwind
- [ ] `make js` bundles JavaScript
- [ ] `make dev` runs Air with live reload
- [ ] `make build` creates production binary
- [ ] `make clean` removes generated files

### Documentation

- [ ] Tailwind configuration documented
- [ ] Alpine.js usage patterns documented
- [ ] Air configuration documented
- [ ] Makefile targets documented
- [ ] Development workflow documented

## Next Epic

[Epic 1.5: Templ-UI Integration →](./1.5-templui-integration.md)
