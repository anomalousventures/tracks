# Epic 1.4: Web Build Pipeline

[← Back to Phase 1](../1-core-web.md) | [← Epic 1.3](./1.3-hashfs-assets.md)

## Overview

Create templates and generator logic for TailwindCSS compilation, JavaScript bundling, Alpine.js integration, and Air live reload in generated projects. This epic implements template files for asset build configuration, development workflow with live reload, and production optimization. The ProjectGenerator will render these templates when running `tracks new`, creating a complete frontend build pipeline with development and production modes.

## Goals

- Templates for TailwindCSS configuration in generated projects
- Template for Air live reload configuration
- JavaScript bundling templates with esbuild and Alpine.js
- Makefile templates for asset building (css, js, dev)
- Development vs production build mode templates
- ProjectGenerator integration to render all templates
- Generated projects compile assets and run with live reload

## Scope

### In Scope

- tailwind.config.js template
- .air.toml template
- web/css/app.css template (Tailwind entry point)
- web/js/app.js template (Alpine.js + utilities)
- Makefile asset build targets template
- PostCSS configuration template (if needed)
- Air tool directive in go.mod template
- Asset build test templates
- ProjectGenerator integration
- Tests that generated projects build assets correctly

### Out of Scope

- Templ-UI components (Epic 1.5)
- Complex JavaScript frameworks (React, Vue)
- TypeScript compilation (future)
- Sass/SCSS preprocessing
- CSS modules
- Advanced PostCSS plugins
- Service workers
- PWA manifest generation

## Task Breakdown

The following tasks will become GitHub issues, ordered by dependency:

### Phase 1: Build Configuration Templates (Tasks 1-15)

1. Create tailwind.config.js template with templ file scanning
2. Create web/css/app.css template (Tailwind entry point)
3. Create web/js/app.js template with Alpine.js
4. Create .air.toml template with file watching
5. Create postcss.config.js template (if needed)
6. Create Makefile css target template
7. Create Makefile js target template
8. Create Makefile assets target template
9. Create Makefile dev target template
10. Create Makefile watch-css target template
11. Create Makefile watch-js target template
12. Add Air to go.mod tool directive template
13. Create .gitignore entries for generated assets
14. Create dark mode toggle JavaScript template
15. Create mobile menu toggle JavaScript template

### Phase 2: ProjectGenerator Integration (Tasks 16-25)

1. Wire tailwind.config.js template into ProjectGenerator
2. Wire .air.toml template into ProjectGenerator
3. Wire web/css/app.css template into ProjectGenerator
4. Wire web/js/app.js template into ProjectGenerator
5. Wire postcss.config.js template into ProjectGenerator
6. Update Makefile template rendering for asset targets
7. Update go.mod template rendering to include Air
8. Update .gitignore template for asset output
9. Create web/ directory structure in ProjectGenerator
10. Render all build configuration templates in correct locations

### Phase 3: Testing & Validation (Tasks 26-35)

1. Create asset compilation test template
2. Create Tailwind output verification test template
3. Create JavaScript bundle verification test template
4. Test generated tailwind.config.js scans templ files correctly
5. Test generated .air.toml watches correct files
6. Test generated Makefile css target compiles CSS
7. Test generated Makefile js target bundles JavaScript
8. Integration test: generated project compiles assets successfully
9. Integration test: generated project runs with Air live reload
10. Integration test: verify dark mode toggle works

## Dependencies

### Prerequisites

- Phase 0 completed (project generation working)
- Epic 1.1 completed (Chi router)
- Epic 1.2 completed (Templ templates)
- Epic 1.3 completed (HashFS assets)
- Go 1.25+ (tool directive support)

### External Dependencies

- TailwindCSS (installed via npx in generated projects)
- esbuild (installed via npx in generated projects)
- Alpine.js (loaded via CDN or bundled)
- HTMX (loaded via CDN initially)
- `github.com/air-verse/air` - Live reload (added to generated go.mod)

### Blocks

- Epic 1.5 (Templ-UI Integration) - needs Tailwind and Alpine.js templates

## Acceptance Criteria

### Templates Created

- [ ] tailwind.config.js template exists
- [ ] .air.toml template exists
- [ ] web/css/app.css template exists
- [ ] web/js/app.js template exists
- [ ] Makefile asset target templates exist (css, js, assets, dev)
- [ ] Asset compilation test templates exist
- [ ] All templates use Go template syntax correctly

### Generator Integration

- [ ] ProjectGenerator renders tailwind.config.js
- [ ] ProjectGenerator renders .air.toml
- [ ] ProjectGenerator creates web/ directory structure
- [ ] ProjectGenerator renders asset source files
- [ ] Air dependency appears in generated go.mod
- [ ] Asset targets appear in generated Makefile
- [ ] .gitignore updated for asset output

### Generated Code Quality

- [ ] Generated tailwind.config.js scans .templ files correctly
- [ ] Generated .air.toml watches correct files
- [ ] Generated `make css` compiles Tailwind successfully
- [ ] Generated `make js` bundles JavaScript successfully
- [ ] Generated `make assets` builds all assets
- [ ] Generated `make dev` runs Air with live reload
- [ ] Generated asset tests pass
- [ ] Dark mode toggle works in generated project
- [ ] Alpine.js components work in generated project

### Testing

- [ ] Unit tests verify template rendering
- [ ] Integration tests verify generated project builds assets
- [ ] Integration tests verify Air live reload works
- [ ] All tests pass in CI

## Next Epic

[Epic 1.5: Templ-UI Integration →](./1.5-templui-integration.md)
