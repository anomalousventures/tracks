# Epic 1.4: Web Build Pipeline

[← Back to Phase 1](../1-core-web.md) | [← Epic 1.3](./1.3-hashfs-assets.md)

## Overview

Create templates and generator logic for TailwindCSS compilation, JavaScript bundling, HTMX v2 integration with extensions, and Air live reload in generated projects. This epic implements template files for asset build configuration, development workflow with live reload, and production optimization. The ProjectGenerator will render these templates when running `tracks new`, creating a complete frontend build pipeline with development and production modes. HTMX v2 and its extensions (head-support, idiomorph, response-targets) will be bundled as part of the asset pipeline, not loaded via CDN.

## Goals

- Templates for TailwindCSS configuration in generated projects
- Template for Air live reload configuration
- JavaScript bundling templates with esbuild, HTMX v2, and HTMX extensions
- Integrate counter example component into homepage (demonstrates HTMX patterns)
- Makefile templates for asset building (css, js, dev)
- Development vs production build mode templates
- ProjectGenerator integration to render all templates
- Generated projects compile assets and run with live reload

## Scope

### In Scope

- tailwind.config.js template
- .air.toml template
- web/css/app.css template (Tailwind entry point)
- web/js/app.js template (HTMX v2 bundling entry point)
- HTMX v2 download and bundling via npm/esbuild
- HTMX extensions with specific use cases:
  - head-support: Update document head during partial updates
  - idiomorph: Intelligent DOM morphing for smoother transitions
  - response-targets: Target different elements based on HTTP response
- Integrate counter component into homepage template
- Makefile asset build targets template
- PostCSS configuration template (if needed)
- Air tool directive in go.mod template
- Asset build test templates
- ProjectGenerator integration
- Tests that generated projects build assets correctly

### Out of Scope

- Templ-UI components (Epic 1.5)
- Alpine.js integration (deferred to post-MVP; Templ-UI provides component interactivity)
- Complex JavaScript frameworks (React, Vue)
- TypeScript compilation (future)
- Sass/SCSS preprocessing
- CSS modules
- Advanced PostCSS plugins
- Service workers
- PWA manifest generation

## Task Breakdown

The following tasks will become GitHub issues, ordered by dependency:

### Phase 1: Build Configuration Templates (Tasks 1-15)

1. Create tailwind.config.js template with templ file scanning
2. Create web/css/app.css template (Tailwind entry point)
3. Create web/js/app.js template (HTMX v2 bundling entry point)
4. Create package.json template with HTMX v2 and extensions
5. Create .air.toml template with file watching
6. Create postcss.config.js template (if needed)
7. Create Makefile css target template
8. Create Makefile js target template (includes HTMX bundling)
9. Create Makefile assets target template
10. Create Makefile dev target template
11. Create Makefile watch-css target template
12. Create Makefile watch-js target template
13. Add Air to go.mod tool directive template
14. Create .gitignore entries for generated assets and node_modules
15. Integrate counter example component into homepage (demonstrates HTMX partial rendering patterns)

### Phase 2: ProjectGenerator Integration (Tasks 16-25)

1. Wire tailwind.config.js template into ProjectGenerator
2. Wire .air.toml template into ProjectGenerator
3. Wire web/css/app.css template into ProjectGenerator
4. Wire web/js/app.js template into ProjectGenerator
5. Wire package.json template into ProjectGenerator
6. Wire postcss.config.js template into ProjectGenerator
7. Update Makefile template rendering for asset targets
8. Update go.mod template rendering to include Air
9. Update .gitignore template for asset output and node_modules
10. Create web/ directory structure in ProjectGenerator
11. Render all build configuration templates in correct locations
12. Update base layout template to load bundled htmx.min.js (not CDN)
13. Wire counter component routes into ProjectGenerator

### Phase 3: Testing & Validation (Tasks 26-35)

1. Create asset compilation test template
2. Create Tailwind output verification test template
3. Create JavaScript bundle verification test template (HTMX v2 + extensions)
4. Test generated tailwind.config.js scans templ files correctly
5. Test generated .air.toml watches correct files
6. Test generated Makefile css target compiles CSS
7. Test generated Makefile js target bundles JavaScript with HTMX
8. Test package.json includes HTMX v2 and all three extensions
9. Integration test: generated project compiles assets successfully
10. Integration test: generated project runs with Air live reload
11. Integration test: verify counter component works on homepage
12. Integration test: verify HTMX extensions load correctly

## Dependencies

### Prerequisites

- Phase 0 completed (project generation working)
- Epic 1.1 completed (Chi router)
- Epic 1.2 completed (Templ templates)
- Epic 1.3 completed (HashFS assets)
- Go 1.25+ (tool directive support)

### External Dependencies

- TailwindCSS (installed via npm in generated projects)
- esbuild (installed via npm in generated projects)
- HTMX v2 (`htmx.org` - installed via npm and bundled)
- HTMX extension: head-support (`@htmx-org/htmx-head-support`)
- HTMX extension: idiomorph (`@htmx-org/idiomorph`)
- HTMX extension: response-targets (`@htmx-org/htmx-response-targets`)
- `github.com/air-verse/air` - Live reload (added to generated go.mod)

### Blocks

- Epic 1.5 (Templ-UI Integration) - needs Tailwind templates and asset pipeline

## Acceptance Criteria

### Templates Created

- [ ] tailwind.config.js template exists
- [ ] .air.toml template exists
- [ ] web/css/app.css template exists
- [ ] web/js/app.js template exists (HTMX v2 bundling entry)
- [ ] package.json template exists (includes HTMX v2 and extensions)
- [ ] Makefile asset target templates exist (css, js, assets, dev)
- [ ] Counter component integrated into homepage template
- [ ] Asset compilation test templates exist
- [ ] All templates use Go template syntax correctly

### Generator Integration

- [ ] ProjectGenerator renders tailwind.config.js
- [ ] ProjectGenerator renders .air.toml
- [ ] ProjectGenerator renders package.json with HTMX v2 dependencies
- [ ] ProjectGenerator creates web/ directory structure
- [ ] ProjectGenerator renders asset source files
- [ ] Air dependency appears in generated go.mod
- [ ] Asset targets appear in generated Makefile
- [ ] .gitignore updated for asset output and node_modules
- [ ] Counter component routes registered in generated routes.go
- [ ] Base layout loads bundled htmx.min.js (not CDN)

### Generated Code Quality

- [ ] Generated tailwind.config.js scans .templ files correctly
- [ ] Generated .air.toml watches correct files
- [ ] Generated `make css` compiles Tailwind successfully
- [ ] Generated `make js` bundles JavaScript with HTMX v2 successfully
- [ ] Generated `make assets` builds all assets
- [ ] Generated `make dev` runs Air with live reload
- [ ] Generated asset tests pass
- [ ] Counter component works on homepage in generated project
- [ ] HTMX v2 and extensions load correctly in generated project
- [ ] HTMX partial rendering works correctly (counter increments without full page reload)

### Testing

- [ ] Unit tests verify template rendering
- [ ] Integration tests verify generated project builds assets
- [ ] Integration tests verify Air live reload works
- [ ] All tests pass in CI

## Next Epic

[Epic 1.5: Templ-UI Integration →](./1.5-templui-integration.md)
