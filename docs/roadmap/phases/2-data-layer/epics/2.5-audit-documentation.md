# Epic 2.5: Audit, Integration & Documentation

[← Back to Phase 2](../2-data-layer.md) | [← Epic 2.4](./2.4-database-cli.md)

**Status:** Not Started

## Overview

Audit existing database-related templates against PRD specifications, verify complete integration of all Phase 2 components, and create comprehensive documentation for the database layer. This epic ensures quality and completeness of the Phase 2 implementation.

## Goals

- Audit existing templates (db.go, sqlc.yaml, docker-compose, config.go) against PRD
- Fix any gaps found during audit
- Create database documentation for website
- Update generated project README with database section
- Document driver-specific patterns and troubleshooting

## Scope

### In Scope

- Audit db.go.tmpl against PRD (connection pooling, driver settings)
- Audit docker-compose.yml.tmpl against PRD (health checks, volumes)
- Audit config.go.tmpl against PRD (all database options)
- Audit go.mod.tmpl for all required dependencies
- Database setup guide for website
- Migration writing guide for website
- SQLC query patterns guide for website
- Driver selection guide for website
- Troubleshooting guide for website
- Generated README database section

### Out of Scope

- New template creation (done in previous epics)
- CLI help text improvements (separate task)
- Video tutorials
- Example applications

## GitHub Issues

| Issue | Title | Scope |
|-------|-------|-------|
| [#533](https://github.com/anomalousventures/tracks/issues/533) | Template audit and fixes | PRD compliance for db.go, docker-compose, config.go, go.mod |
| [#534](https://github.com/anomalousventures/tracks/issues/534) | Website database documentation | Setup, migrations, SQLC queries, troubleshooting guides |
| [#535](https://github.com/anomalousventures/tracks/issues/535) | Generated README + final E2E validation | README database section, full workflow tests for all drivers |

## Dependencies

### Prerequisites

- Epic 2.1-2.4 completed
- Phase 1 completed (base project generation)

### External Dependencies

- Docusaurus for website documentation

### Blocks

- Phase 3 (Auth System) - Can begin once Phase 2 complete

## Acceptance Criteria

### Template Audits Complete

- [ ] db.go.tmpl matches PRD connection pooling specs
- [ ] db.go.tmpl has driver-specific optimizations
- [ ] docker-compose.yml.tmpl has proper health checks
- [ ] config.go.tmpl has all database options
- [ ] go.mod.tmpl has all required dependencies
- [ ] All gaps documented and fixed

### Website Documentation Complete

- [ ] Database setup guide exists and is complete
- [ ] Migration guide exists with examples
- [ ] SQLC query patterns guide exists
- [ ] Troubleshooting guide exists
- [ ] All guides pass Docusaurus build
- [ ] Documentation is linked from main docs navigation

### Generated Project Documentation

- [ ] README.md includes database section
- [ ] Quick start commands are accurate
- [ ] Links to website documentation work

### Integration Verified

- [ ] sqlite3 full workflow passes
- [ ] postgres full workflow passes (Docker)
- [ ] go-libsql full workflow passes
- [ ] All make targets work
- [ ] All tracks db commands work

## Technical Notes

### PRD Connection Pooling Specs

**PostgreSQL:**

- MaxOpenConns: 25
- MaxIdleConns: 5
- ConnMaxIdleTime: 5 minutes
- ConnMaxLifetime: 1 hour

**SQLite/go-libsql:**

- MaxOpenConns: 1 (single writer)
- MaxIdleConns: 1
- WAL mode enabled

### Documentation Structure

```text
website/docs/guides/
├── database-setup.md      # Driver selection, initial setup
├── migrations.md          # Writing migrations, Goose patterns
├── sqlc-queries.md        # SQLC annotations, query patterns
└── database-troubleshooting.md
    ├── SQLite/go-libsql issues
    ├── PostgreSQL issues
    ├── Connection issues
    └── Migration issues
```

### README Database Section Template

```markdown
## Database

This project uses [DRIVER_NAME] for data persistence.

### Quick Start

\`\`\`bash
# Run migrations
make migrate-up

# Check migration status
make migrate-status

# Create new migration
make migrate-create NAME=add_users
\`\`\`

### Using Tracks CLI

\`\`\`bash
# Run migrations
tracks db migrate

# Check status
tracks db status

# Rollback
tracks db rollback
\`\`\`

For full documentation, see [Database Guide](https://tracks.dev/docs/guides/database-setup).
```

### Audit Checklist Template

| File | Section | PRD Reference | Status | Notes |
|------|---------|---------------|--------|-------|
| db.go.tmpl | Pool settings | 2.1.3 | ⏳ | |
| db.go.tmpl | WAL mode | 2.1.4 | ⏳ | |
| docker-compose.yml.tmpl | Health checks | 2.1.5 | ⏳ | |
| config.go.tmpl | Timeout settings | 2.1.2 | ⏳ | |

## Next Phase

[Phase 3: Auth System →](../../3-auth-system.md)
